# ãƒ¡ã‚¸ãƒ£ãƒ¼ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€æ‹¬æ›´æ–°

**Cycle ID:** `20260219002433` **Started:** 2026-02-19 00:24:33 **Status:** ğŸŸ¢
Done

---

## ğŸ“ What & Why

outdatedçŠ¶æ…‹ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸5ã¤ã‚’å®‰å…¨ãªé †åºã§1ã¤ãšã¤æ›´æ–°ã™ã‚‹ã€‚
ãƒã‚°ä¿®æ­£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚æœ€æ–°ç‰ˆã«è¿½å¾“ã€‚

## ğŸ¯ Goals

- 5ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æœ€æ–°ã«æ›´æ–°
- å„æ›´æ–°ã”ã¨ã«ãƒ†ã‚¹ãƒˆå…¨é€šéã‚’ç¢ºèªï¼ˆæ®µéšçš„ã«å®‰å…¨ç¢ºèªï¼‰
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´ãŒå¿…è¦ãªç®‡æ‰€ã¯æœ€å°é™ã«ä¿®æ­£

## ğŸ“ Design

### æ›´æ–°å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆå®Ÿè¡Œé †åºï¼‰

| # | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸        | Current â†’ Latest    | ã‚³ãƒ¼ãƒ‰å¤‰æ›´                         | ãƒªã‚¹ã‚¯ |
| - | ----------------- | ------------------- | ---------------------------------- | ------ |
| 1 | `@types/chrome`   | 0.0.254 â†’ 0.1.36    | ãªã—ï¼ˆç‹¬è‡ªå‹å®šç¾©ä½¿ç”¨ï¼‰             | æ¥µä½   |
| 2 | `@types/node`     | ^20.19.33 â†’ ^25.2.3 | ãªã—ï¼ˆpackage.jsonã¨æ•´åˆï¼‰         | æ¥µä½   |
| 3 | `@preact/signals` | ^1.3.4 â†’ ^2.0.0     | ãªã—ï¼ˆsignal/Signal/`.value`äº’æ›ï¼‰ | ä½     |
| 4 | `esbuild`         | ^0.20.2 â†’ ^0.27.0   | ãªã—ï¼ˆplatform:browserä½¿ç”¨ï¼‰       | ä½     |
| 5 | `marked`          | ^11.2.0 â†’ ^17.0.0   | `setOptions` â†’ `marked.use`        | ä¸­     |

### Files to Change

```
deno.json                             - 5ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·æ›´æ–°
src/domain/markdown/parser.ts         - marked.setOptions â†’ marked.use ã«å¤‰æ›´ (Step 5ã®ã¿)
```

### Key Points

- **1ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãšã¤æ›´æ–°â†’ãƒ†ã‚¹ãƒˆ**:
  å•é¡ŒãŒèµ·ããŸã‚‰ã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒåŸå› ã‹å³åº§ã«ç‰¹å®šå¯èƒ½
- **ãƒªã‚¹ã‚¯ä½ã„é †ã«å®Ÿè¡Œ**: å‹å®šç¾© â†’ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é †ã§å®‰å…¨ã«é€²è¡Œ
- **markedãŒæœ€ã‚‚æ³¨æ„ãŒå¿…è¦**:
  v15ã®HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ç§»å‹•ã§ToCè¦‹å‡ºã—IDç”Ÿæˆã«å½±éŸ¿ã®å¯èƒ½æ€§ã€‚E2Eå¿…é ˆ

## ğŸ“‹ Implementation Steps

### Step 1: `@types/chrome` 0.0.254 â†’ 0.1.36

- `deno.json`: `"@types/chrome": "npm:@types/chrome@^0.1.36"`
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´: ãªã—ï¼ˆç‹¬è‡ª `chrome.d.ts` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚å½±éŸ¿ã‚¼ãƒ­ï¼‰
- ãƒ†ã‚¹ãƒˆ: `deno task lint && deno task test`

### Step 2: `@types/node` ^20.19.33 â†’ ^25.2.3

- `deno.json`: `"@types/node": "npm:@types/node@^25.2.3"`
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´: ãªã—ï¼ˆNode.js APIã‚’ç›´æ¥ä½¿ç”¨ã—ã¦ã„ãªã„ï¼‰
- ãƒ†ã‚¹ãƒˆ: `deno task lint && deno task test`

### Step 3: `@preact/signals` ^1.3.4 â†’ ^2.0.0

- `deno.json`: `"@preact/signals": "npm:@preact/signals@^2.0.0"`
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´: ãªã—ï¼ˆ`signal()`, `Signal<T>`, `.value` ã¯å…¨ã¦äº’æ›ï¼‰
- ãƒ†ã‚¹ãƒˆ: `deno task lint && deno task test`
- ç¢ºèªãƒã‚¤ãƒ³ãƒˆ: ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ›´æ–°ãŒæ­£å¸¸ã‹

### Step 4: `esbuild` ^0.20.2 â†’ ^0.27.0

- `deno.json`: `"esbuild": "npm:esbuild@^0.27.0"`
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´: ãªã—ï¼ˆ`platform: "browser"` ä½¿ç”¨ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¤‰æ›´ã®å½±éŸ¿ãªã—ï¼‰
- ãƒ†ã‚¹ãƒˆ: `deno task build:dev && deno task lint && deno task test`
- ç¢ºèªãƒã‚¤ãƒ³ãƒˆ: ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã‹ã€`esbuild-deno-loader` ã¨ã®äº’æ›æ€§

### Step 5: `marked` ^11.2.0 â†’ ^17.0.0

- `deno.json`: `"marked": "npm:marked@^17.0.0"`
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´:
  ```typescript
  // parser.ts: setOptions â†’ marked.use ã«çµ±ä¸€
  // Before
  marked.setOptions({ gfm: true, breaks: true });
  // After
  marked.use({ gfm: true, breaks: true });
  ```
- ãƒ†ã‚¹ãƒˆ: `deno task lint && deno task test`
- ç¢ºèªãƒã‚¤ãƒ³ãƒˆ:
  - v15ã®HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ç§»å‹•: ToCè¦‹å‡ºã—IDã®ä¸€è‡´æ¤œè¨¼
  - v17ã®ãƒªã‚¹ãƒˆæ§‹é€ å¤‰æ›´: ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å‡ºåŠ›ã®ç¢ºèª

### Step 6: E2Eå…¨é€šéç¢ºèª

- `deno task build:dev && deno task test:e2e:wsl2`
- å…¨84 E2Eãƒ†ã‚¹ãƒˆé€šéã‚’ç¢ºèªï¼ˆç‰¹ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£13ã‚±ãƒ¼ã‚¹ï¼‰

### Step 7: ã‚³ãƒŸãƒƒãƒˆ

- `smart-commit` ã§å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ

## âœ… Tests

- [ ] Step 1-4: å„æ›´æ–°å¾Œã« `deno task lint && deno task test` é€šé
- [ ] Step 4: `deno task build:dev` ã§ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- [ ] Step 5: Unit testå…¨é€šéï¼ˆç‰¹ã«parser.test.ts, extractor.test.tsï¼‰
- [ ] Step 6: E2Eå…¨é€šéï¼ˆç‰¹ã«security.spec.tsï¼‰
- [ ] ToCè¦‹å‡ºã—IDãŒæ­£ã—ãä¸€è‡´ã™ã‚‹ã“ã¨
- [ ] Markdownãƒªã‚¹ãƒˆãƒ»ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å‡ºåŠ›ãŒæ­£å¸¸ãªã“ã¨

## ğŸ”’ Security

- [ ] XSSã‚µãƒ‹ã‚¿ã‚¤ã‚ºãŒæ­£å¸¸ã«å‹•ä½œï¼ˆsanitizer.test.tsé€šéï¼‰
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£E2E 13ã‚±ãƒ¼ã‚¹å…¨é€šéï¼ˆsecurity.spec.tsï¼‰
- [ ] markedæ›´æ–°å¾Œã®HTMLå‡ºåŠ›ã«XSSãƒ™ã‚¯ã‚¿ãƒ¼ãŒå«ã¾ã‚Œãªã„ã“ã¨

## ğŸ“Š Progress

| Step | Package         | Status |
| ---- | --------------- | ------ |
| 1    | @types/chrome   | ğŸŸ¢     |
| 2    | @types/node     | ğŸŸ¢     |
| 3    | @preact/signals | ğŸŸ¢     |
| 4    | esbuild         | ğŸŸ¢     |
| 5    | marked          | ğŸŸ¢     |
| 6    | E2Eå…¨é€šéç¢ºèª   | ğŸŸ¢     |
| 7    | ã‚³ãƒŸãƒƒãƒˆ        | ğŸŸ¡     |

**Legend:** âšª Pending Â· ğŸŸ¡ In Progress Â· ğŸŸ¢ Done

---

**Notes:**

- markedæ›´æ–°æ™‚ã«deno.lockã®å¤ã„è§£æ±ºçµæœãŒmarked-highlightã¨markedé–“ã®å‹ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’èµ·ã“ã—ãŸã€‚deno.lockå‰Šé™¤ +
  deno clean + å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§è§£æ±ºã€‚
- 389 Unit tests + 86 E2E testsï¼ˆ3 skippedï¼‰å…¨é€šé
