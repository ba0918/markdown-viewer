#!/bin/sh
# Pre-push hook: ãƒ“ãƒ«ãƒ‰ç¢ºèªã¨E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

set -e

echo "ğŸš€ Pre-push checks running..."

# Build check
echo "ğŸ—ï¸  Checking build..."
if ! deno task build; then
  echo "âŒ Build failed!"
  echo "ğŸ’¡ Fix build errors before pushing."
  exit 1
fi

# E2E tests (WSL2ç’°å¢ƒã‚’è€ƒæ…®)
echo "ğŸ­ Running E2E tests..."
if command -v xvfb-run > /dev/null; then
  # WSL2ç’°å¢ƒ
  if ! deno task test:e2e:wsl2; then
    echo "âŒ E2E tests failed!"
    echo "ğŸ’¡ Fix E2E test failures before pushing."
    exit 1
  fi
else
  # é€šå¸¸ç’°å¢ƒ
  if ! deno task test:e2e; then
    echo "âŒ E2E tests failed!"
    echo "ğŸ’¡ Fix E2E test failures before pushing."
    exit 1
  fi
fi

echo "âœ… Pre-push checks passed!"
exit 0
